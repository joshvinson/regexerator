<?xml version="1.0" encoding="UTF-8"?>
<project name="Regexerator Coverity Tasks" default="clean" basedir=".">
	<property file="src/res/props/rxr.properties" />

	<description>
		Regexerator Coverity Tasks
    </description>

	<!-- set global properties for this build -->
	<property name="src" location="src" />
	<property name="bin" location="cov-bin" />
	<property name="int-dir" location="cov-int-dir" />
	<property name="cov-root" location="C:/Program Files/Coverity/Coverity Integrity Center 5.3/static-analysis" />

	<target name="clean" description="clean output folders">
		<delete dir="${bin}" />
		<delete dir="${int-dir}" />
	</target>

	<target name="compile" description="compile the source ">
		<mkdir dir="${bin}" />
		<javac srcdir="${src}" destdir="${bin}" debug="on" />
		<copy todir="${bin}">
			<fileset dir="${src}" includes="res/**" />
		</copy>
	</target>

	<property name="anttask.jar" value="${cov-root}/library/coverity-anttask.jar" />

	<target name="cov._internal_.loadtask">
		<taskdef resource="com/coverity/anttask.xml" classpath="${anttask.jar}" />
	</target>

	<target name="cov._internal_.static.analyze" depends="cov._internal_.loadtask,compile">
		<covanalyzejava dir="${int-dir}" classfiles="${bin}" findsource="${src}" additionaloptions="--all" />
	</target>

	<target name="cov._internal_.static.commit" depends="cov._internal_.loadtask">
		<covcommitdefects dir="${int-dir}" stream="regexerator" remote="localhost" user="admin" password="123456" />
	</target>

	<target name="cov.static.all" depends="compile,cov._internal_.loadtask,cov._internal_.static.analyze,cov._internal_.static.commit">
	</target>

	<target name="cov._internal_.dynamic.test" depends="cov._internal_.loadtask">
		<cov-start-da-broker failonerror="true" configfile="dynamic-config.txt" onlytestconnection="true" />
	</target>

	<target name="cov._internal_.dynamic.commit" depends="cov._internal_.loadtask, compile">
		<cov-start-da-broker failonerror="true" configfile="dynamic-config.txt" sourcepath="${src}" classpath="${bin}" onlysourcecommit="true" />
	</target>

	<target name="cov._internal_.dynamic.listen" depends="cov._internal_.loadtask">
		<cov-start-da-broker failonerror="true" configfile="dynamic-config.txt" onlylisten="true" />
	</target>

	<target name="cov._internal_.dynamic.run" depends="cov._internal_.loadtask,compile">
		<cov-dynamic-analyze-java classname="rxr.RXR" failonerror="true" classpath="${bin}" />
	</target>

	<target name="cov._internal_.dynamic.shutdown" depends="cov._internal_.loadtask">
		<cov-stop-da-broker shutdowntype="clean" />
	</target>

	<target name="cov.dynamic.start" depends="cov._internal_.loadtask,compile,cov._internal_.dynamic.commit,cov._internal_.dynamic.listen,cov._internal_.dynamic.run">
	</target>

	<target name="cov.dynamic.stop" depends="cov._internal_.loadtask,compile,cov._internal_.dynamic.shutdown">
	</target>
</project>